(()=>{"use strict";var e={935:(e,s,o)=>{s.__esModule=!0;var r=o(442),t=o(26),n=o(857),a=o(74),i=o(356),d=o(933),l=o(995),g=o(887),u=o(179),c=o(532),p=o(95),v=o(321),f=o(140),M=o(938),w=o(571),m=o(79),h=function(){function e(){this.nativeReady=!1,this.receivers=[],this.queuedMessages=[],this.queuedKlarnaPaymentsMessages=[],this.version=m.MessageBridgeVersion,this.eventListeners=[],this.handshakeResponseParamsMap={},this.base64Controller=new g.Base64ControllerImpl,this.messageController=new u.MessageControllerImpl,this.crossWindowController=new c.CrossWindowControllerImpl(this),this.nativeController=new f.NativeControllerImpl,this.receiverController=new w.ReceiverControllerImpl,this.base64Controller.overrideDefaults(),this.setupCrossWindowController()}return e.prototype.addReceiver=function(e,s){try{this.receiverController.addReceiver(this,e,s),this.notifyEvent({name:"AddedReceiver",payload:{name:e}})}catch(s){l.Logger.default.error("MessageBridge.addReceiver failed.",s),this.notifyEvent({name:"AddReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.removeReceiver=function(e,s){try{this.receiverController.removeReceiver(this,e,s),this.notifyEvent({name:"RemovedReceiver",payload:{name:e}})}catch(s){l.Logger.default.error("MessageBridge.removeReceiver failed.",s),this.notifyEvent({name:"RemoveReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.postMessage=function(e,s){void 0===s&&(s=!1);try{this.messageController.postMessage(this,e,s)}catch(s){l.Logger.default.error("MessageBridge.postMessage failed.",s),this.notifyEvent({name:"PostMessageFailed",payload:{action:e.action,sender:e.sender,receiver:e.receiver,error:s.toString()}})}},e.prototype.isNativeReady=function(){return this.nativeController.isNativeReady(this)},e.prototype.isNativeReadyAsync=function(){return this.nativeController.isNativeReadyAsync(this)},e.prototype.setNativeReady=function(){try{this.nativeController.setNativeReady(this),this.reportEndpoints()}catch(e){l.Logger.default.error("MessageBridge.setNativeReady failed.",e),this.notifyEvent({name:"NativeHookSetNativeReadyFailed",payload:{receivers:this.receivers.toString(),queuedMessages:this.queuedMessages.toString(),error:e.toString()}})}},e.prototype.inSdkWebView=function(){try{return this.nativeController.isSdkWebView(this)}catch(e){return l.Logger.default.error("MessageBridge.inSdkWebView failed.",e),!1}},e.prototype.inSdkWebViewAsync=function(){return this.nativeController.isSdkWebViewAsync(this)},e.prototype.addEventListener=function(e){this.eventListeners.indexOf(e)<=-1&&this.eventListeners.push(e)},e.prototype.removeEventListener=function(e){this.eventListeners=this.eventListeners.filter((function(s){return s!=e}))},e.prototype.notifyEvent=function(e){this.eventListeners.forEach((function(s){return s(e)}))},e.prototype.compareVersion=function(e,s){try{return d.Utils.compareVersion(e,s)}catch(e){return l.Logger.default.error("MessageBridge.compareVersion failed.",e),0}},e.prototype.destroy=function(){this.teardownCrossWindowController()},e.prototype.setupCrossWindowController=function(){if(this.crossWindowController.register(this),this.crossWindowController.mode===p.CrossWindowMode.Frame){var e=new M.CrossWindowMessageImpl(v.CrossWindowMessageAction.IsNativeReadyRequest,null);this.crossWindowController.postMessage(e);var s=new M.CrossWindowMessageImpl(v.CrossWindowMessageAction.IsSdkWebViewRequest,null);this.crossWindowController.postMessage(s)}else this.nativeController.isSdkWebView(this);l.Logger.default.debug("CrossWindowController Setup")},e.prototype.teardownCrossWindowController=function(){this.crossWindowController.unregister(this),l.Logger.default.debug("CrossWindowController Teardown")},e.prototype.reportEndpoints=function(){var e=new t.BridgeDataImpl(this.version,new n.EndpointDataImpl(a.Endpoints.Analytics.Staging,a.Endpoints.Analytics.Production),new n.EndpointDataImpl(a.Endpoints.DeviceData.Staging,a.Endpoints.DeviceData.Production));this.messageController.postEventMessageToNative(this,new r.BridgeMessageImpl(i.BridgeMessageAction.EndpointsReported,null,null,e))},e}();s.MessageBridgeImpl=h},887:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=o(79),n=function(){function e(){}return e.prototype.overrideDefaults=function(){if(null==window.defaultAtob||null==window.sdkAtob){var e=window.atob,s=function(s){return 0===s.indexOf(t.KlarnaUtf8Base64Prefix)?function(s){try{return decodeURIComponent(atob(s).split("").map((function(e){var s;return null===(s=e.charCodeAt(0).toString(16).match(/.{1,2}/g))||void 0===s?void 0:s.map((function(e){return"%"+("00"+e).slice(-2)})).join("")})).join(""))}catch(o){r.Logger.default.error("atob-custom",{"src-string":s,msg:o.toString()});try{return e(s)}catch(e){throw r.Logger.default.error("atob-default",{"src-string":s,msg:e.toString()}),e}}}(s.substr(t.KlarnaUtf8Base64Prefix.length)):e(s)};window.atob=s,window.defaultAtob=e,window.sdkAtob=s}else r.Logger.default.debug("Already installed custom atob(). Skipping.")},e}();s.Base64ControllerImpl=n},532:(e,s,o)=>{s.__esModule=!0;var r=o(321),t=o(95),n=o(995),a=o(448),i=o(870),d=o(820),l=o(938),g=o(933),u=o(207),c=o(24),p=o(539),v=function(){function e(s){var o=this;this.windows=[],this.delegates=[new c.RegisterWindowMessageDelegate,new u.IsSdkWebViewMessageDelegate,new d.NativeReadyMessageDelegate,new a.NativeMessageDelegate,new i.ReceiverMessageDelegate],this.responseCallbacks={},this.listener=function(e){try{o.receivedMessage(e)}catch(e){n.Logger.default.error("CrossWindowMessage listener caught exception",e)}},this.windowId=e.getWindowId(),this.messageBridge=s,window.self!==window.top?this.mode=t.CrossWindowMode.Frame:this.mode=t.CrossWindowMode.Root}return e.getWindowId=function(){var e=window.__KlarnaNativeHookWindowId;if(e)return e;var s=g.Utils.createUUIDv4();return window.__KlarnaNativeHookWindowId=s,s},e.prototype.postMessage=function(e,s){void 0===s&&(s=null);try{n.Logger.default.debug("CrossWindowMessage Will Send",e,window.__KlarnaNativeHook),s&&(this.responseCallbacks[e.messageId]=s);var o=e.encode();switch(this.mode){case t.CrossWindowMode.Root:p.CrossWindowUtils.postMessageToNestedWindows(o,window.self);break;case t.CrossWindowMode.Frame:p.CrossWindowUtils.postMessageToWindow(o,window.top)}}catch(o){n.Logger.default.error("CrossWindowMessage post has failed",e,s,window.__KlarnaNativeHook,o)}},e.prototype.register=function(e){if(this.messageBridge!=e){var s=this.messageBridge;this.messageBridge=e,n.Logger.default.debug("CrossWindowController message bridge replaced",e,s)}window.addEventListener("message",this.listener,{once:!1,capture:!1,passive:!1}),this.mode===t.CrossWindowMode.Frame&&this.postMessage(new l.CrossWindowMessageImpl(r.CrossWindowMessageAction.RegisterWindow,null)),n.Logger.default.debug("CrossWindowController Registered")},e.prototype.unregister=function(e){this.messageBridge=null,window.removeEventListener("message",this.listener,{capture:!1}),n.Logger.default.debug("CrossWindowController Un-Registered")},e.prototype.receivedMessage=function(e){if(n.Logger.default.debug("MessageEvent Received",e),e.source!==window.self){var s=e.data,o=l.CrossWindowMessageImpl.decode(s);n.Logger.default.debug("CrossWindowMessage Received",o,window.__KlarnaNativeHook),this.receivedCrossWindowMessage(o),n.Logger.default.debug("CrossWindowMessage Processed",o,window.__KlarnaNativeHook)}else n.Logger.default.debug("MessageEvent received from self")},e.prototype.receivedCrossWindowMessage=function(e){if(this.validateCrossWindowMessage(e)){var s=this.messageBridge;if(null!=s){if(!this.callResponseCallback(e)){for(var o=0,r=this.delegates;o<r.length;o++){if(r[o].handleMessage(this,s,e))return}n.Logger.default.error("CrossWindowController message could not be handled",this,s,e)}}else n.Logger.default.error("CrossWindowController null message bridge")}else n.Logger.default.error("CrossWindowController received invalid message",e)},e.prototype.validateCrossWindowMessage=function(e){return null!=e.messageId&&null!=e.messageId&&e.messageId.length>0&&null!=e.action&&null!=e.action&&e.action.length>0},e.prototype.callResponseCallback=function(e){var s=this.responseCallbacks[e.messageId];return!!s&&s(e)},e}();s.CrossWindowControllerImpl=v},321:(e,s)=>{s.__esModule=!0,function(e){e.RegisterWindow="RegisterWindow",e.PostReceiverMessage="PostReceiverMessage",e.PostNativeMessage="PostNativeMessage",e.IsNativeReadyRequest="IsNativeReadyRequest",e.IsNativeReadyResponse="IsNativeReadyResponse",e.IsSdkWebViewRequest="IsSdkWebViewRequest",e.IsSdkWebViewResponse="IsSdkWebViewResponse"}(s.CrossWindowMessageAction||(s.CrossWindowMessageAction={}))},95:(e,s)=>{s.__esModule=!0,function(e){e.Root="Root",e.Frame="Frame"}(s.CrossWindowMode||(s.CrossWindowMode={}))},294:(e,s)=>{s.__esModule=!0;var o=function(e){this.isNativeReady=e};s.IsNativeReadyResponseData=o},281:(e,s)=>{s.__esModule=!0;var o=function(e){this.isSdkWebView=e};s.IsSdkWebViewResponseData=o},207:(e,s,o)=>{s.__esModule=!0;var r=o(321),t=o(95),n=o(938),a=o(995),i=o(281),d=function(){function e(){}return e.prototype.handleMessage=function(e,s,o){try{if(o.action===r.CrossWindowMessageAction.IsSdkWebViewRequest){if(e.mode===t.CrossWindowMode.Root){var d=new i.IsSdkWebViewResponseData(s.nativeController.isSdkWebView(s)),l=new n.CrossWindowMessageImpl(r.CrossWindowMessageAction.IsSdkWebViewResponse,d,o.messageId);e.postMessage(l),a.Logger.default.debug("Processed IsSdkWebViewRequest",o,l)}else a.Logger.default.warn("Frame Message Bridge received invalid message",o);return!0}if(o.action===r.CrossWindowMessageAction.IsSdkWebViewResponse){if(e.mode===t.CrossWindowMode.Frame){d=o.data;s.nativeController.setIsSdkWebView(d.isSdkWebView),a.Logger.default.debug("Processed IsSdkWebViewResponse",o,d)}else a.Logger.default.warn("Root Message Bridge received invalid message",o);return!0}}catch(r){a.Logger.default.error("IsSdkWebViewMessageDelegate handle message failed",e,s,o,r)}return!1},e}();s.IsSdkWebViewMessageDelegate=d},448:(e,s,o)=>{s.__esModule=!0;var r=o(321),t=o(995),n=o(95),a=function(){function e(){}return e.prototype.handleMessage=function(e,s,o){try{if(o.action===r.CrossWindowMessageAction.PostNativeMessage){if(e.mode===n.CrossWindowMode.Root){var a=o.data;return s.messageController.postEventMessageToNative(s,a),t.Logger.default.debug("Relayed Native Message"),!0}return t.Logger.default.warn("Frame Message Bridge received invalid message",o),!0}}catch(r){t.Logger.default.error("NativeMessageDelegate handle message failed",e,s,o,r)}return!1},e}();s.NativeMessageDelegate=a},820:(e,s,o)=>{s.__esModule=!0;var r=o(321),t=o(95),n=o(294),a=o(995),i=o(938),d=function(){function e(){}return e.prototype.handleMessage=function(e,s,o){try{if(o.action===r.CrossWindowMessageAction.IsNativeReadyRequest){if(e.mode===t.CrossWindowMode.Root){var d=new n.IsNativeReadyResponseData(s.nativeReady),l=new i.CrossWindowMessageImpl(r.CrossWindowMessageAction.IsNativeReadyResponse,d,o.messageId);e.postMessage(l),a.Logger.default.debug("Processed IsNativeReadyRequest",o,l)}else a.Logger.default.warn("Frame Message Bridge received invalid message",o);return!0}if(o.action===r.CrossWindowMessageAction.IsNativeReadyResponse){if(e.mode===t.CrossWindowMode.Frame){var g=o.data;g.isNativeReady&&s.setNativeReady(),a.Logger.default.debug("Processed IsNativeReadyResponseData",o,g,this)}else a.Logger.default.warn("Root Message Bridge received invalid message",o);return!0}}catch(r){a.Logger.default.error("NativeReadyMessageDelegate handle message failed",e,s,o,r)}return!1},e}();s.NativeReadyMessageDelegate=d},870:(e,s,o)=>{s.__esModule=!0;var r=o(321),t=o(995),n=o(95),a=function(){function e(){}return e.prototype.handleMessage=function(e,s,o){try{if(o.action===r.CrossWindowMessageAction.PostReceiverMessage){if(e.mode===n.CrossWindowMode.Frame){var a=o.data;try{s.postMessage(a,!0)}catch(e){t.Logger.default.error("Relayed Receiver Message failed to post message via bridge",o,s)}t.Logger.default.debug("Relayed Receiver Message to Message Bridge",o,s)}else t.Logger.default.warn("Root Message Bridge received invalid message",o);return!0}}catch(r){t.Logger.default.error("ReceiverMessageDelegate handle message failed",e,s,o,r)}return!1},e}();s.ReceiverMessageDelegate=a},24:(e,s,o)=>{s.__esModule=!0;var r=o(95),t=o(321),n=o(995),a=function(){function e(){}return e.prototype.handleMessage=function(e,s,o){try{if(o.action===t.CrossWindowMessageAction.RegisterWindow){if(e.mode===r.CrossWindowMode.Root){var a=o.sourceWindowId;e.windows.push(a),n.Logger.default.debug("CrossWindow registered",a)}else n.Logger.default.warn("Frame Message Bridge received invalid message",o);return!0}}catch(e){n.Logger.default.error("CrossWindow failed to register",o)}return!1},e}();s.RegisterWindowMessageDelegate=a},938:(e,s,o)=>{s.__esModule=!0;var r=o(532),t=o(933),n=function(){function e(e,s,o,n,a){void 0===o&&(o=t.Utils.createUUIDv4()),void 0===n&&(n=window.origin),void 0===a&&(a=r.CrossWindowControllerImpl.getWindowId()),this.messageId=o,this.sourceWindowId=a,this.sourceOrigin=n,this.action=e,this.data=s}return e.prototype.encode=function(){return JSON.stringify(this)},e.decode=function(e){return JSON.parse(e)},e}();s.CrossWindowMessageImpl=n},539:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=function(){function e(){}return e.postMessageToNestedWindows=function(s,o){try{for(var t=o.frames,n=0;n<t.length;n++){var a=t[n];e.postMessageToWindow(s,a);try{this.postMessageToNestedWindows(s,a)}catch(e){r.Logger.default.error("CrossWindowMessage post failed to deep nested window")}}}catch(e){r.Logger.default.error("CrossWindowMessage post failed to nested window")}},e.postMessageToWindow=function(e,s){try{r.Logger.default.debug("CrossWindowMessage Will Send",e,window.__KlarnaNativeHook);s.postMessage(e,"*"),r.Logger.default.debug("CrossWindowMessage Sent",e,window.__KlarnaNativeHook,"*")}catch(s){r.Logger.default.error("CrossWindowMessage Failed to Send",s,e,window.__KlarnaNativeHook)}},e}();s.CrossWindowUtils=t},179:(e,s,o)=>{s.__esModule=!0;var r=o(791),t=o(593),n=o(621),a=o(749),i=o(779),d=o(218),l=o(777),g=o(299),u=o(321),c=o(95),p=o(938),v=o(548),f=function(){function e(){this.nativeMessageSender=new r.NativeMessageSender,this.componentMessageSender=new t.ComponentMessageSender,this.messageProcessors=[new n.HandshakeResponseActionMessageProcessor,new a.StringifiedProductOptionsMessageProcessor,new i.SetExperimentsFormatMessageProcessor,new d.PaymentsWrapperExtractBase64MessageProcessor,new l.SessionDataBase64MessageProcessor,new g.FullscreenShowCanScrollMessageProcessor,new v.HandshakeCacheMessageProcessor]}return e.prototype.postMessage=function(e,s,o){o&&e.crossWindowController.mode===c.CrossWindowMode.Root&&e.crossWindowController.postMessage(new p.CrossWindowMessageImpl(u.CrossWindowMessageAction.PostReceiverMessage,s)),this.messageProcessors.forEach((function(r,t){r.processMessage(e,s,o)})),this.componentMessageSender.sendMessage(e,s),o||this.nativeMessageSender.sendMessage(e,s)},e.prototype.postEventMessageToNative=function(e,s){this.nativeMessageSender.postEventMessageToNative(e,s)},e}();s.MessageControllerImpl=f},299:(e,s,o)=>{s.__esModule=!0;var r=o(933),t=function(){function e(){}return e.getHandshakeResponseParams=function(e,s,o){return o?r.Utils.getHandshakeResponseParams(e,s.receiver):r.Utils.getHandshakeResponseParams(e,s.sender)},e.prototype.processMessage=function(s,o,r){var t;"fullscreenShow"===o.action&&("android"===(null===(t=e.getHandshakeResponseParams(s,o,r))||void 0===t?void 0:t.osName)&&(o.params.canScroll="true"))},e}();s.FullscreenShowCanScrollMessageProcessor=t},548:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=o(327),n=function(){function e(){}return e.prototype.processMessage=function(e,s,o){if(s.action===t.ClientMessageActions.handshakeResponse)try{e.handshakeResponseParamsMap[s.receiver]=s.params,r.Logger.default.debug("Cached handshake",s.receiver,s.params)}catch(e){var n="Error caching handshake response params: ";try{n+=JSON.stringify(e)}catch(e){}finally{r.Logger.default.error("cache-handshakeResponseParams",{msg:n})}}},e}();s.HandshakeCacheMessageProcessor=n},621:(e,s)=>{s.__esModule=!0;var o=function(){function e(){}return e.prototype.processMessage=function(e,s,o){"handhakeResponse"===s.action&&(s.action="handshakeResponse")},e}();s.HandshakeResponseActionMessageProcessor=o},218:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,o){"handshake"===s.action&&"KlarnaPaymentsWrapper"===s.sender&&window.__WrapperMessageController&&window.__WrapperMessageController._extractBase64&&(window.__WrapperMessageController._extractBase64=function(e,s,o){if(null==e.params[o]||"null"===e.params[o])return null;try{var t=e.params[o],n=atob(t);return JSON.parse(n)}catch(e){r.Logger.default.error("extract-b64",{msg:"Error extracting b64 with custom atob() "+JSON.stringify(e)})}})},e}();s.PaymentsWrapperExtractBase64MessageProcessor=t},777:(e,s,o)=>{s.__esModule=!0;var r=o(79),t=o(995),n=function(){function e(){}return e.prototype.processMessage=function(e,s,o){if("actionToComponent"===s.action)try{if("undefined"!==s.params.sessionData&&null!=s.params.sessionData)if("null"===s.params.sessionData)delete s.params.sessionData;else{var n=s.params.sessionData;s.params.sessionData=r.KlarnaUtf8Base64Prefix+n.replace(/\n/g,"").replace(/-/g,"+").replace(/_/g,"/")}}catch(e){t.Logger.default.error("re-format-session-data",{msg:"Error reformatting session data: "+JSON.stringify(e)})}},e}();s.SessionDataBase64MessageProcessor=n},779:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,o){if("setExperiments"===s.action)try{if(void 0!==s.params.experiments&&"undefined"!==s.params.experiments&&null!=s.params.experiments){var t=s.params.experiments;"string"!=typeof t&&(s.params.experiments=JSON.stringify(t))}}catch(e){r.Logger.default.error("rewrite-experiments",{msg:"Error stringifying experiments parameter sent from KP: "+JSON.stringify(e)})}},e}();s.SetExperimentsFormatMessageProcessor=t},749:(e,s,o)=>{s.__esModule=!0;var r=o(714),t=o(995),n=function(){function e(){}return e.prototype.processMessage=function(e,s,o){if("handshakeResponse"===s.action)try{for(var n=s.params.osName,a=s.params.nativeVersion,i=0,d=r.StringifiedKlarnaInitDataSdks;i<d.length;i++){var l=d[i];if(n===l.osName&&a===l.nativeVersion){var g=s.params.productOptions;if(void 0!==g&&"undefined"!==g&&null!=g){var u=JSON.parse(g);if(null!=u&&null!=u.klarnaInitData)try{var c=JSON.parse(u.klarnaInitData);u.klarnaInitData=c,s.params.productOptions=JSON.stringify(u)}catch(e){var p="Error parsing klarnaInitData parameter inside productOptions: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}}}}}catch(e){p="Error parsing productOptions parameter: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}},e}();s.StringifiedProductOptionsMessageProcessor=n},593:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=o(959),n=o(327),a=o(933),i=function(){function e(){}return e.isKlarnaPaymentsReady=function(e){var s=a.Utils.getHandshakeResponseParams(e,t.KlarnaProductNames.KlarnaPayments);return null!=s&&null!=s},e.queueMessageIfNeeded=function(s,o){return"Native"===o.sender&&o.receiver===t.KlarnaProductNames.KlarnaPaymentsWrapper&&o.action!==n.ClientMessageActions.handshakeResponse&&!e.isKlarnaPaymentsReady(s)&&(s.queuedKlarnaPaymentsMessages.push(o),r.Logger.default.info("Message Queued",o),!0)},e.prototype.releaseQueuedMessagesIfReady=function(s,o){if("Native"===o.sender&&o.receiver===t.KlarnaProductNames.KlarnaPayments&&o.action===n.ClientMessageActions.handshakeResponse&&e.isKlarnaPaymentsReady(s)&&s.queuedKlarnaPaymentsMessages.length>0){r.Logger.default.debug("KlarnaPayments received handshake response, de-queuing messages.");for(var a=0,i=s.queuedKlarnaPaymentsMessages;a<i.length;a++){var d=i[a];this.sendMessage(s,d),r.Logger.default.info("Message De-queued",d)}return s.queuedKlarnaPaymentsMessages=[],!0}return!1},e.prototype.sendMessage=function(s,o){if(!e.queueMessageIfNeeded(s,o)){for(var t=0,n=s.receivers;t<n.length;t++){var a=n[t];a.name!==o.receiver&&"*"!==o.receiver||(a.callback(o),r.Logger.default.info("Receiver Notified for Message",o,a))}this.releaseQueuedMessagesIfReady(s,o)}},e}();s.ComponentMessageSender=i},791:(e,s,o)=>{s.__esModule=!0;var r=o(149),t=o(442),n=o(356),a=o(933),i=o(618),d=o(95),l=o(321),g=o(938),u=o(995),c=function(){function e(){this.delayedMessages=[],this.sendDelayedMessagesWithInterval()}return e.createBridgeMessage=function(e){return new t.BridgeMessageImpl(n.BridgeMessageAction.MessagePosted,null,e,null)},e.shouldDelayMessage=function(e,s){if(-1!==r.ClientFullscreenActions.indexOf(s.action)){var o=a.Utils.getHandshakeResponseParams(e,s.sender);if(o)for(var t=o.osName,n=o.merchantAppName,d=0,l=i.DelayedFullscreenMerchants;d<l.length;d++){var g=l[d];if(t===g.osName&&n===g.merchantAppName)return!0}}return!1},e.prototype.sendMessage=function(s,o){s.nativeReady?e.shouldDelayMessage(s,o)?this.delayedMessages.push(new p(s,o)):this.postEventMessageToNative(s,e.createBridgeMessage(o)):s.queuedMessages.push(o)},e.prototype.postEventMessageToNative=function(e,s){if(e.crossWindowController.mode===d.CrossWindowMode.Frame)e.crossWindowController.postMessage(new g.CrossWindowMessageImpl(l.CrossWindowMessageAction.PostNativeMessage,s));else{var o=e.nativeController.getNativeMessageHandler();null!=o&&(o.postMessage(JSON.stringify(s)),u.Logger.default.info("Native Notified for Message",s,o))}},e.prototype.sendDelayedMessagesWithInterval=function(){var s=this;window.setInterval((function(){var o=s.delayedMessages.shift();null!=o&&null!=o.message&&s.postEventMessageToNative(o.messageBridge,e.createBridgeMessage(o.message))}),200)},e}();s.NativeMessageSender=c;var p=function(e,s){this.messageBridge=e,this.message=s}},140:(e,s,o)=>{s.__esModule=!0;var r=o(442),t=o(356),n=o(95),a=o(294),i=o(321),d=o(938),l=o(281),g=function(){function e(){this._isSdkWebView=!1}return e.prototype.isNativeReady=function(e){return e.nativeReady},e.prototype.isNativeReadyAsync=function(e){return e.crossWindowController.mode===n.CrossWindowMode.Root?new Promise((function(s){return s(e.isNativeReady())})):new Promise((function(s,o){var r=window.setTimeout((function(){o("CrossWindowMessage Response Timeout")}),3e3),t=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsNativeReadyRequest,null);e.crossWindowController.postMessage(t,(function(e){if(e.action===i.CrossWindowMessageAction.IsNativeReadyResponse){var o=e.data;window.clearTimeout(r),s(o.isNativeReady)}return!1}))}))},e.prototype.isSdkWebView=function(e){var s=null!=this.getNativeMessageHandler();if(s!=this._isSdkWebView)if(e.crossWindowController.mode===n.CrossWindowMode.Root){var o=new l.IsSdkWebViewResponseData(s),r=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsSdkWebViewResponse,o);e.crossWindowController.postMessage(r),this._isSdkWebView=s}else s&&(this._isSdkWebView=s);return this._isSdkWebView},e.prototype.isSdkWebViewAsync=function(e){var s=this;return e.crossWindowController.mode===n.CrossWindowMode.Root?new Promise((function(o){return o(s.isSdkWebView(e))})):new Promise((function(o,r){var t=window.setTimeout((function(){r("CrossWindowMessage Response Timeout")}),3e3),n=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsSdkWebViewRequest,null);e.crossWindowController.postMessage(n,(function(e){if(e.action===i.CrossWindowMessageAction.IsSdkWebViewResponse){var r=e.data;s._isSdkWebView=r.isSdkWebView,window.clearTimeout(t),o(r.isSdkWebView)}return!1}))}))},e.prototype.setNativeReady=function(e){if(e.nativeReady)e.messageController.postEventMessageToNative(e,new r.BridgeMessageImpl(t.BridgeMessageAction.MessageBridgeAlreadyRunning,null,null,null)),e.notifyEvent({name:"NativeHookAlreadyReady",payload:{receivers:e.receivers.toString(),queuedMessages:e.queuedMessages.toString()}});else{e.nativeReady=!0,e.messageController.postEventMessageToNative(e,new r.BridgeMessageImpl(t.BridgeMessageAction.MessageBridgeWillStart,null,null,null));for(var s=0,o=e.receivers.filter((function(e){return!e.registeredNatively}));s<o.length;s++){var l=o[s];e.messageController.postEventMessageToNative(e,new r.BridgeMessageImpl(t.BridgeMessageAction.ReceiverAdded,l.name,null,null)),l.registeredNatively=!0}for(var g=0,u=e.queuedMessages;g<u.length;g++){var c=u[g];e.messageController.postEventMessageToNative(e,new r.BridgeMessageImpl(t.BridgeMessageAction.MessagePosted,null,c,null))}if(e.queuedMessages=[],e.crossWindowController.mode===n.CrossWindowMode.Root){var p=new a.IsNativeReadyResponseData(e.nativeReady);c=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsNativeReadyResponse,p);e.crossWindowController.postMessage(c)}e.notifyEvent({name:"NativeHookReady",payload:{receivers:e.receivers.toString(),queuedMessages:e.queuedMessages.toString()}})}},e.prototype.setIsSdkWebView=function(e){this._isSdkWebView=e},e.prototype.getNativeMessageHandler=function(){return e.getNativeMessageHandler()},e.getNativeMessageHandler=function(){var e;return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.KlarnaNativeHookMessageHandler?e=window.webkit.messageHandlers.KlarnaNativeHookMessageHandler:window.KlarnaNativeHookMessageHandler&&(e=window.KlarnaNativeHookMessageHandler),e},e}();s.NativeControllerImpl=g},571:(e,s,o)=>{s.__esModule=!0;var r=o(242),t=o(442),n=o(356),a=function(){function e(){}return e.prototype.addReceiver=function(e,s,o){var a=new r.MessageReceiverImpl(s,o);e.nativeReady&&(e.messageController.postEventMessageToNative(e,new t.BridgeMessageImpl(n.BridgeMessageAction.ReceiverAdded,a.name,null,null)),a.registeredNatively=!0),e.receivers.push(a)},e.prototype.removeReceiver=function(e,s,o){e.receivers=e.receivers.filter((function(e){return e.name!==s&&e.callback!==o})),e.nativeReady&&e.messageController.postEventMessageToNative(e,new t.BridgeMessageImpl(n.BridgeMessageAction.ReceiverRemoved,s,null,null))},e}();s.ReceiverControllerImpl=a},995:(e,s)=>{var o;s.__esModule=!0,function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.None=4]="None"}(o=s.LogLevel||(s.LogLevel={}));var r=function(){function e(){this.level=o.None,this.delegate=null}return e.prototype.debug=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level===o.Debug&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.log.apply(console,e))}catch(e){}},e.prototype.info=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=o.Info&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.info.apply(console,e))}catch(e){}},e.prototype.warn=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=o.Warn&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.warn.apply(console,e))}catch(e){}},e.prototype.error=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=o.Error&&(null!=this.delegate&&this.delegate.logError(this._stringifyParams(e)),console.error.apply(console,e))}catch(e){}},e.prototype._stringifyParams=function(e){try{return JSON.stringify(e,null,2)}catch(e){return"Couldn't stringify logging params."}},e.default=new e,e}();s.Logger=r},933:(e,s,o)=>{s.__esModule=!0;var r=o(995),t=function(){function e(){}return e.getHandshakeResponseParams=function(e,s){return e.handshakeResponseParamsMap[s]},e.compareVersion=function(e,s){for(var o=e.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));o.length<3;)o.push(0);for(var r=s.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));r.length<3;)r.push(0);return o[0]>r[0]?1:o[0]<r[0]?-1:o[1]>r[1]?1:o[1]<r[1]?-1:o[2]>r[2]?1:o[2]<r[2]?-1:0},e.createUUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var s=16*Math.random()|0;return("x"==e?s:3&s|8).toString(16)}))},e.replaceBridge=function(e,s){r.Logger.default.info("Replacing old bridge",e);var o=e.receivers,t=e.queuedMessages,n=e.eventListeners,a=e.handshakeResponseParamsMap,i=e.queuedKlarnaPaymentsMessages;if(s.notifyEvent({name:"WillReplaceNativeHook",payload:{oldMessageBridgeVersion:e.version,newMessageBridgeVersion:s.version,receivers:o.toString(),queuedMessages:t.toString(),nativeReady:e.nativeReady.toString()}}),window.__KlarnaNativeHook=s,s.notifyEvent({name:"ReplacedNativeHook",payload:{oldMessageBridgeVersion:e.version,newMessageBridgeVersion:s.version}}),e.destroy&&e.destroy(),null!=n&&n.forEach((function(e){return s.addEventListener(e)})),null!=a)if(a.forEach)a.forEach((function(e,o){s.handshakeResponseParamsMap[o]=e}));else for(var d in a)s.handshakeResponseParamsMap[d]=a[d];t.forEach((function(e){return s.queuedMessages.push(e)})),o.forEach((function(e){return s.addReceiver(e.name,e.callback)})),void 0!==i&&i.forEach((function(e){return s.queuedKlarnaPaymentsMessages.push(e)})),e.nativeReady&&s.setNativeReady(),r.Logger.default.info("Replaced old bridge",s)},e}();s.Utils=t},356:(e,s)=>{s.__esModule=!0,function(e){e.ReceiverAdded="ReceiverAdded",e.ReceiverRemoved="ReceiverRemoved",e.MessagePosted="MessagePosted",e.EndpointsReported="EndpointsReported",e.MessageBridgeWillStart="MessageBridgeWillStart",e.MessageBridgeAlreadyRunning="MessageBridgeAlreadyRunning"}(s.BridgeMessageAction||(s.BridgeMessageAction={}))},149:(e,s,o)=>{s.__esModule=!0;var r=o(327);s.ClientFullscreenActions=[r.ClientMessageActions.fullscreenReplaceWebView,r.ClientMessageActions.fullscreenMoveWebView,r.ClientMessageActions.fullscreenReplaceOverlay,r.ClientMessageActions.fullscreenRestoreWebView]},327:(e,s)=>{s.__esModule=!0,function(e){e.fullscreenReplaceWebView="fullscreenReplaceWebView",e.fullscreenMoveWebView="fullscreenMoveWebView",e.fullscreenReplaceOverlay="fullscreenReplaceOverlay",e.fullscreenRestoreWebView="fullscreenRestoreWebView",e.handshakeResponse="handshakeResponse",e.actionToComponent="actionToComponent"}(s.ClientMessageActions||(s.ClientMessageActions={}))},618:(e,s)=>{s.__esModule=!0,s.DelayedFullscreenMerchants=[{merchantAppName:"boohooMAN",osName:"iOS"},{merchantAppName:"Nasty Gal",osName:"iOS"},{merchantAppName:"MISSPAP",osName:"iOS"},{merchantAppName:"boohoo",osName:"iOS"},{merchantAppName:"PLT UAT",osName:"iOS"}]},74:(e,s)=>{s.__esModule=!0,s.Endpoints={Analytics:{Staging:"evt-eu.staging.eu1.yaco.klarna.net",Production:"not-reallly-evt.klarna.com"},DeviceData:{Staging:"devicedata-staging.klarna",Production:"devicedata-production.klarna"}}},959:(e,s)=>{s.__esModule=!0,function(e){e.KlarnaPayments="KlarnaPayments",e.KlarnaPaymentsWrapper="KlarnaPaymentsWrapper"}(s.KlarnaProductNames||(s.KlarnaProductNames={}))},79:(e,s)=>{s.__esModule=!0,s.KlarnaUtf8Base64Prefix="klarna-base-64-utf8::",s.MessageBridgeVersion="v1.3.0-d34a9195a8c"},714:(e,s)=>{s.__esModule=!0,s.StringifiedKlarnaInitDataSdks=[{osName:"iOS",nativeVersion:"2.0.26"},{osName:"iOS",nativeVersion:"2.0.27"},{osName:"iOS",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.26"},{osName:"android",nativeVersion:"2.0.27"},{osName:"android",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.29"}]},26:(e,s)=>{s.__esModule=!0;var o=function(e,s,o){this.bridgeVersion=e,this.endpoints={analytics:s,deviceInfo:o}};s.BridgeDataImpl=o},442:(e,s)=>{s.__esModule=!0;var o=function(e,s,o,r){this.action=e,this.receiverName=s,this.message=o,this.bridgeData=r};s.BridgeMessageImpl=o},857:(e,s)=>{s.__esModule=!0;var o=function(e,s){this.staging=e,this.production=s};s.EndpointDataImpl=o},242:(e,s,o)=>{s.__esModule=!0;var r=o(933),t=function(e,s){this.registeredNatively=!1,this.id=r.Utils.createUUIDv4(),this.name=e,this.callback=s};s.MessageReceiverImpl=t}},s={};function o(r){var t=s[r];if(void 0!==t)return t.exports;var n=s[r]={exports:{}};return e[r](n,n.exports,o),n.exports}var r={};(()=>{r.__esModule=!0;var e=o(935),s=o(933),t=o(79);!function(){try{null==window.__KlarnaNativeHook?window.__KlarnaNativeHook=new e.MessageBridgeImpl:1===s.Utils.compareVersion(t.MessageBridgeVersion,window.__KlarnaNativeHook.version)&&s.Utils.replaceBridge(window.__KlarnaNativeHook,new e.MessageBridgeImpl)}catch(e){console.error("__KlarnaNativeHook MessageBridge initialization failed.",e)}}()})();for(var t in r)this[t]=r[t];r.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();